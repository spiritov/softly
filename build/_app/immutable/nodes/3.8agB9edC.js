import"../chunks/DsnmJJEf.js";import{S as ve,aa as Z,u as z,T as D,ah as E,ab as i,ae as v,af as n,ac as b,O as w,ai as M,a9 as s,ag as u,ad as ee,x as ce,a7 as de,a8 as Y}from"../chunks/BvyEtBnD.js";import{s as V}from"../chunks/Cp0nVd2g.js";import{i as T}from"../chunks/CT2Gfhmu.js";import{k as R,s as O,a as e,e as q,i as H,t as C,b as he,c as ue,f as L}from"../chunks/zDkcfiI6.js";const t=ve({leftStart:!1,rightStart:!1,leftFinish:!1,rightFinish:!1,leftFinishTime:0,rightFinishTime:0,resetPulse:!1});var ge=i("<span> </span>"),pe=i("<span> </span>"),me=i('<div class="absolute flex h-32 w-full items-center justify-center gap-36"><!> <!></div>');function be(W,h){Z(h,!0);let g=E(0),S=E(0),N=M(()=>c(w(g))),j=M(()=>c(w(S)));function c(a){const o=Math.floor(a/6e3).toString().padStart(2,"0"),x=Math.floor(a/100%60).toString().padStart(2,"0"),y=Math.floor(a%100).toString().padStart(2,"0");return`${o}:${x}.${y}`}z(()=>{if(t.leftStart&&!t.leftFinish){const a=Math.floor(Date.now()/10),o=setInterval(()=>{D(g,Math.floor(Date.now()/10-a),!0)},77);return()=>{clearInterval(o)}}}),z(()=>{if(t.rightStart&&!t.rightFinish){const a=Date.now()/10,o=setInterval(()=>{D(S,Math.floor(Date.now()/10-a),!0)},77);return()=>{clearInterval(o)}}}),z(()=>{t.resetPulse&&(D(g,0),D(S,0),t.resetPulse=!1)});var d=me(),$=v(d);R($,()=>[t.leftStart,t.leftFinish],a=>{var o=ge(),x=v(o,!0);n(o),b(y=>{O(o,1,`${t.leftStart?"text-palewhite":"text-palewhite/50"} font-chivomono text-center text-5xl transition-colors duration-2000`),V(x,y)},[()=>t.leftFinish?c(t.leftFinishTime):w(N)]),s(a,o)});var _=u($,2);R(_,()=>[t.rightStart,t.rightFinish],a=>{var o=pe(),x=v(o,!0);n(o),b(y=>{O(o,1,`${t.rightStart?"text-palewhite":"text-palewhite/50"} font-chivomono text-center text-5xl transition-colors duration-2000`),V(x,y)},[()=>t.rightFinish?c(t.rightFinishTime):w(j)]),s(a,o)}),n(d),s(W,d),ee()}const _e=W=>{var h=We();q(h,20,()=>({length:2}),H,(g,S)=>{var N=Te();s(g,N)}),n(h),C(3,h,()=>ue),s(W,h)},xe=W=>{var h=Me(),g=v(h);{var S=c=>{var d=Pe(),$=v(d);R($,()=>e.stage,_=>{var a=Ne(),o=v(a,!0);n(a),b(()=>V(o,e.stage)),C(1,a,()=>L),s(_,a)}),n(d),s(c,d)};T(g,c=>{e.stage&&c(S)})}var N=u(g,2);{var j=c=>{var d=De(),$=v(d);R($,()=>e.map,_=>{var a=Oe(),o=v(a,!0);n(a),b(()=>V(o,e.map)),C(1,a,()=>L),s(_,a)}),n(d),s(c,d)};T(N,c=>{e.map&&c(j)})}n(h),s(W,h)};var ke=i('<img class="relative z-50 flex h-24 w-fit rounded-lg" alt="flag"/>'),we=i("<span> </span>"),Se=i("<div></div>"),$e=i('<div class="border-palewhite/50 size-8 border-4"></div>'),ye=i('<span class="relative bottom-0.5 text-3xl opacity-50"> </span>'),Fe=i('<div><div></div> <div id="spacer"></div> <!> <div class="flex flex-col gap-2 text-5xl"><!> <div><!> <!> <!></div></div></div>'),Te=i('<div class="flex basis-1/2 items-center justify-center border-white text-3xl first:border-r-[1px]">960x540px</div>'),We=i('<div class="bg-palewhite/50 flex h-[540px] w-full"></div>'),Ne=i('<span class="relative left-2 flex w-full skew-x-[30deg] items-center justify-center py-3"> </span>'),Pe=i('<div class="bg-fullblack/90 border-palewhite/50 relative right-8 min-w-64 skew-x-[-30deg] rounded-br-xl border-r-4 border-b-4 px-12"><!></div>'),Oe=i('<span class="relative right-2 flex w-full skew-x-[-30deg] justify-center py-3"> </span>'),De=i('<div class="bg-fullblack/90 border-palewhite/50 relative left-8 ml-auto min-w-64 skew-x-[30deg] rounded-bl-xl border-b-4 border-l-4 px-12"><!></div>'),Me=i('<div class="flex h-16 w-full justify-between text-3xl"><!> <!></div>'),Ve=i(`<span class="absolute z-999 h-screen w-full bg-black/60 p-64 text-4xl">WebSocket connecting... <span class="text-palewhite/60 text-3xl">(if this takes more than a few seconds after setting the token, it's likely failed.)</span></span>`),je=i('<span class="absolute z-999 h-screen w-full bg-black/60 p-64 text-4xl opacity-0 transition-opacity delay-1000 duration-1000 starting:opacity-100">WebSocket connected.</span>'),ze=i("<!> <!>",1),Re=i('<div><div class="relative flex h-32 w-full shrink-0"><!> <!> <!></div> <!> <!></div>');function Ae(W,h){Z(h,!0);const g=(r,l=ce)=>{var m=Fe(),I=v(m),G=u(I,4);{var A=f=>{var p=ke();b(()=>he(p,"src",`https://countryflagsapi.netlify.app/flag/${e[l()+"Flag"]??""}.svg`)),s(f,p)};T(G,f=>{e[l()+"Flag"]&&f(A)})}var k=u(G,2),P=v(k);{var se=f=>{var p=de(),F=Y(p);R(F,()=>e[l()+"Name"],ne=>{var J=we(),fe=v(J,!0);n(J),b(()=>V(fe,e[l()+"Name"].name)),C(1,J,()=>L),s(ne,J)}),s(f,p)};T(P,f=>{e[l()+"Name"]&&f(se)})}var B=u(P,2),U=v(B);q(U,17,()=>({length:e[l()+"Score"]}),H,(f,p)=>{var F=Se();b(()=>O(F,1,`starting:border-palewhite/50 starting:bg-overlay-orange/0 border-palewhite/50 bg-overlay-orange size-8 border-4 transition-colors duration-1000 ${e.useTeamColors?"":`hue-rotate-${e.hueRotate}`}`)),s(f,F)});var X=u(U,2);q(X,17,()=>({length:e.maxScore-e[l()+"Score"]}),H,(f,p)=>{var F=$e();s(f,F)});var ie=u(X,2);{var le=f=>{var p=ye(),F=v(p);n(p),b(()=>V(F,`PR ${e[l()+"PR"]??""}`)),s(f,p)};T(ie,f=>{e.usePR&&f(le)})}n(B),n(k),n(m),b(()=>{O(m,1,`relative flex basis-1/2 items-center gap-4 ${l()==="left"?"flex-row text-left":"flex-row-reverse text-right"}`),O(I,1,`absolute -z-10 h-full w-full ${l()==="left"?`bg-linear-to-r/oklch ${e.useTeamColors?w(j):w(d)}`:`bg-linear-to-l/oklch ${e.useTeamColors?w(c):w($)}`}`),O(B,1,`flex gap-2 ${l()==="left"?"flex-row":"flex-row-reverse"}`)}),s(r,m)};function S(){t.leftStart=!1,t.rightStart=!1,t.leftFinish=!1,t.rightFinish=!1,t.resetPulse=!0}function N(r){switch(r.type){case"timer_start":`${r.steamid}`===e.leftName.steamid?(t.leftFinish=!1,t.leftStart=!0):`${r.steamid}`===e.rightName.steamid&&(t.leftFinish=!1,t.rightStart=!0);break;case"timer_finish":`${r.steamid}`===e.leftName.steamid?(t.leftFinish=!0,t.leftFinishTime=Math.round(r.time*100)):`${r.steamid}`===e.rightName.steamid&&(t.rightFinish=!0,t.rightFinishTime=Math.round(r.time*100));break}}let j=M(()=>`from-tf-blu ${e.useSinglePOV?"to-fullblack/0":" to-fullblack/60"} to-75%`),c=M(()=>`from-tf-red ${e.useSinglePOV?"to-fullblack/0":" to-fullblack/60"} to-75%`),d=M(()=>`from-overlay-orange/90 ${e.useSinglePOV?"to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),$=M(()=>`from-overlay-orange/90 ${e.useSinglePOV?"to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),_=E(!1),a;{for(const[r,l]of Object.entries(e))e[r]=JSON.parse(localStorage.getItem(r));window.addEventListener("storage",r=>{e[r.key]=JSON.parse(r.newValue)}),z(()=>{if(e.useWebSocket&&e.useWebSocketToken!==""){const r=e.useWebSocketToken;a=new WebSocket(`wss://flyio-silent-sea-6505.fly.dev/?token=${r}`),a.onopen=l=>{console.log("[WebSocket] connection opened."),D(_,!0)},a.onmessage=l=>{const m=JSON.parse(l.data);console.log("[WebSocket] received data..",m),N(m)}}return()=>{a&&(a.close(),console.log("[WebSocket] closed previous connection."),D(_,!1))}}),e.useWebSocket&&e.useWebSocketToken!==""&&z(()=>{e.leftName,e.rightName,S()})}var o=Re(),x=v(o),y=v(x);{var te=r=>{var l=ze(),m=Y(l);be(m,{});var I=u(m,2);{var G=k=>{var P=Ve();C(1,P,()=>L),s(k,P)},A=k=>{var P=je();s(k,P)};T(I,k=>{w(_)?k(A,!1):k(G)})}s(r,l)};T(y,r=>{e.useWebSocket&&e.useWebSocketToken!==""&&e.leftName.steamid&&e.rightName.steamid&&r(te)})}var K=u(y,2);g(K,()=>"left");var ae=u(K,2);g(ae,()=>"right"),n(x);var Q=u(x,2);{var re=r=>{_e(r)};T(Q,r=>{e.useSinglePOV||r(re)})}var oe=u(Q,2);xe(oe),n(o),b(r=>O(o,1,`font-${r??""} flex h-screen w-screen flex-col overflow-hidden`),[()=>e.font.toLowerCase()]),s(W,o),ee()}export{Ae as component};
