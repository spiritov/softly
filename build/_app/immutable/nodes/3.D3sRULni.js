import"../chunks/DsnmJJEf.js";import{S as ne,aa as X,u as V,T as I,ah as U,ab as s,ae as c,af as n,ac as x,O as T,ai as W,a9 as i,ag as b,ad as Y,x as fe,a7 as ve,a8 as ce}from"../chunks/BvyEtBnD.js";import{s as O}from"../chunks/Cp0nVd2g.js";import{i as P}from"../chunks/CT2Gfhmu.js";import{k as j,s as N,a as e,e as G,i as J,t as z,b as de,c as he,f as L}from"../chunks/zDkcfiI6.js";const t=ne({leftStart:!1,rightStart:!1,leftFinish:!1,rightFinish:!1,leftFinishTime:0,rightFinishTime:0,resetPulse:!1});var ue=s("<span> </span>"),me=s("<span> </span>"),ge=s('<div class="absolute flex h-32 w-full items-center justify-center gap-36"><!> <!></div>');function pe(F,d){X(d,!0);let g=U(0),$=U(0),y=W(()=>u(T(g))),D=W(()=>u(T($)));function h(r){const o=`${Math.floor(r/6e3)}`.padStart(2,"0"),S=`${Math.floor(r/100%60)}`.padStart(2,"0"),_=`${Math.floor(r%100)}`.padStart(2,"0");return`${o}:${S}.${_}`}function u(r){const o=`${Math.floor(r/600)}`.padStart(2,"0"),S=`${Math.floor(r/10%60)}`.padStart(2,"0"),_=Math.floor(r%10);return`${o}:${S}.${_}`}V(()=>{if(t.leftStart&&!t.leftFinish){const r=Math.floor(Date.now()/100),o=setInterval(()=>{I(g,Math.floor(Date.now()/100)-r)},100);return()=>{clearInterval(o)}}}),V(()=>{if(t.rightStart&&!t.rightFinish){const r=Math.floor(Date.now()/100),o=setInterval(()=>{I($,Math.floor(Date.now()/100)-r)},100);return()=>{clearInterval(o)}}}),V(()=>{t.resetPulse&&(I(g,0),I($,0),t.resetPulse=!1)});var w=ge(),m=c(w);j(m,()=>[t.leftStart,t.leftFinish],r=>{var o=ue(),S=c(o,!0);n(o),x(_=>{N(o,1,`${t.leftStart?"text-palewhite":"text-palewhite/50"} font-chivomono text-center text-5xl transition-colors duration-2000`),O(S,_)},[()=>t.leftFinish?h(t.leftFinishTime):T(y)]),i(r,o)});var l=b(m,2);j(l,()=>[t.rightStart,t.rightFinish],r=>{var o=me(),S=c(o,!0);n(o),x(_=>{N(o,1,`${t.rightStart?"text-palewhite":"text-palewhite/50"} font-chivomono text-center text-5xl transition-colors duration-2000`),O(S,_)},[()=>t.rightFinish?h(t.rightFinishTime):T(D)]),i(r,o)}),n(w),i(F,w),Y()}const be=F=>{var d=ye();G(d,20,()=>({length:2}),J,(g,$)=>{var y=Fe();i(g,y)}),n(d),z(3,d,()=>he),i(F,d)},_e=F=>{var d=Oe(),g=c(d);{var $=h=>{var u=Pe(),w=c(u);j(w,()=>e.stage,m=>{var l=Me(),r=c(l,!0);n(l),x(()=>O(r,e.stage)),z(1,l,()=>L),i(m,l)}),n(u),i(h,u)};P(g,h=>{e.stage&&h($)})}var y=b(g,2);{var D=h=>{var u=We(),w=c(u);j(w,()=>e.map,m=>{var l=Ne(),r=c(l,!0);n(l),x(()=>O(r,e.map)),z(1,l,()=>L),i(m,l)}),n(u),i(h,u)};P(y,h=>{e.map&&h(D)})}n(d),i(F,d)};var xe=s('<img class="relative z-50 flex h-24 w-fit rounded-lg" alt="flag"/>'),we=s("<span> </span>"),Se=s("<div></div>"),$e=s('<div class="border-palewhite/50 size-8 border-4"></div>'),ke=s('<span class="relative bottom-0.5 text-3xl opacity-50"> </span>'),Te=s('<div><div></div> <div id="spacer"></div> <!> <div class="flex flex-col gap-2 text-5xl"><!> <div><!> <!> <!></div></div></div>'),Fe=s('<div class="flex basis-1/2 items-center justify-center border-white text-3xl first:border-r-[1px]">960x540px</div>'),ye=s('<div class="bg-palewhite/50 flex h-[540px] w-full"></div>'),Me=s('<span class="relative left-2 flex w-full skew-x-[30deg] items-center justify-center py-3"> </span>'),Pe=s('<div class="bg-fullblack/90 border-palewhite/50 relative right-8 min-w-64 skew-x-[-30deg] rounded-br-xl border-r-4 border-b-4 px-12"><!></div>'),Ne=s('<span class="relative right-2 flex w-full skew-x-[-30deg] justify-center py-3"> </span>'),We=s('<div class="bg-fullblack/90 border-palewhite/50 relative left-8 ml-auto min-w-64 skew-x-[30deg] rounded-bl-xl border-b-4 border-l-4 px-12"><!></div>'),Oe=s('<div class="flex h-16 w-full justify-between text-3xl"><!> <!></div>'),De=s('<div><div class="relative flex h-32 w-full shrink-0"><!> <!> <!></div> <!> <!></div>');function Ce(F,d){X(d,!0);const g=(a,f=fe)=>{var M=Te(),B=c(M),E=b(B,4);{var ae=v=>{var p=xe();x(()=>de(p,"src",`https://countryflagsapi.netlify.app/flag/${e[f()+"Flag"]??""}.svg`)),i(v,p)};P(E,v=>{e[f()+"Flag"]&&v(ae)})}var q=b(E,2),H=c(q);{var re=v=>{var p=ve(),k=ce(p);j(k,()=>e[f()+"Name"],se=>{var R=we(),le=c(R,!0);n(R),x(()=>O(le,e[f()+"Name"].name)),z(1,R,()=>L),i(se,R)}),i(v,p)};P(H,v=>{e[f()+"Name"]&&v(re)})}var C=b(H,2),K=c(C);G(K,17,()=>({length:e[f()+"Score"]}),J,(v,p)=>{var k=Se();x(()=>N(k,1,`starting:border-palewhite/50 starting:bg-overlay-orange/0 border-palewhite/50 bg-overlay-orange size-8 border-4 transition-colors duration-1000 ${e.useTeamColors?"":`hue-rotate-${e.hueRotate}`}`)),i(v,k)});var Q=b(K,2);G(Q,17,()=>({length:e.maxScore-e[f()+"Score"]}),J,(v,p)=>{var k=$e();i(v,k)});var oe=b(Q,2);{var ie=v=>{var p=ke(),k=c(p);n(p),x(()=>O(k,`PR ${e[f()+"PR"]??""}`)),i(v,p)};P(oe,v=>{e.usePR&&v(ie)})}n(C),n(q),n(M),x(()=>{N(M,1,`relative flex basis-1/2 items-center gap-4 ${f()==="left"?"flex-row text-left":"flex-row-reverse text-right"}`),N(B,1,`absolute -z-10 h-full w-full ${f()==="left"?`bg-linear-to-r/oklch ${e.useTeamColors?T(D):T(u)}`:`bg-linear-to-l/oklch ${e.useTeamColors?T(h):T(w)}`}`),N(C,1,`flex gap-2 ${f()==="left"?"flex-row":"flex-row-reverse"}`)}),i(a,M)};function $(){t.leftStart=!1,t.rightStart=!1,t.leftFinish=!1,t.rightFinish=!1,t.resetPulse=!0}function y(a){switch(a.type){case"timer_start":`${a.steamid}`===e.leftName.steamid?(t.leftFinish=!1,t.leftStart=!0):`${a.steamid}`===e.rightName.steamid&&(t.leftFinish=!1,t.rightStart=!0);break;case"timer_finish":`${a.steamid}`===e.leftName.steamid?(t.leftFinish=!0,t.leftFinishTime=Math.round(a.time*100)):`${a.steamid}`===e.rightName.steamid&&(t.rightFinish=!0,t.rightFinishTime=Math.round(a.time*100));break}}let D=W(()=>`from-tf-blu ${e.useSinglePOV?"to-fullblack/0":" to-fullblack/60"} to-75%`),h=W(()=>`from-tf-red ${e.useSinglePOV?"to-fullblack/0":" to-fullblack/60"} to-75%`),u=W(()=>`from-overlay-orange/90 ${e.useSinglePOV?"to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),w=W(()=>`from-overlay-orange/90 ${e.useSinglePOV?"to-fullblack/0":" to-fullblack/60"} to-75% hue-rotate-${e.hueRotate}`),m;{for(const[a,f]of Object.entries(e))e[a]=JSON.parse(localStorage.getItem(a));window.addEventListener("storage",a=>{e[a.key]=JSON.parse(a.newValue)}),V(()=>{if(e.useWebSocket&&e.useWebSocketToken!==""){const a=e.useWebSocketToken;m=new WebSocket(`wss://flyio-silent-sea-6505.fly.dev/?token=${a}`),m.onopen=f=>{console.log("[WebSocket] connection opened.")},m.onmessage=f=>{const M=JSON.parse(f.data);console.log("[WebSocket] received data..",M),y(M)}}return()=>{m&&(m.close(),console.log("[WebSocket] closed previous connection."))}}),e.useWebSocket&&e.useWebSocketToken!==""&&V(()=>{e.leftName,e.rightName,$()})}var l=De(),r=c(l),o=c(r);{var S=a=>{pe(a,{})};P(o,a=>{a(S)})}var _=b(o,2);g(_,()=>"left");var Z=b(_,2);g(Z,()=>"right"),n(r);var A=b(r,2);{var ee=a=>{be(a)};P(A,a=>{e.useSinglePOV||a(ee)})}var te=b(A,2);_e(te),n(l),x(a=>N(l,1,`font-${a??""} flex h-screen w-screen flex-col overflow-hidden`),[()=>e.font.toLowerCase()]),i(F,l),Y()}export{Ce as component};
